<div class="flex flex-col h-full min-w-0 overflow-auto">

    <!-- Not connected state -->
    <div *ngIf="!isGoogleConnected" class="flex flex-auto flex-col items-center justify-center">
        <mat-icon style="font-size: 80px; width: 80px; height: 80px; color: rgba(0,0,0,0.15);">photo_library</mat-icon>
        <div class="mt-4 text-xl font-semibold tracking-tight text-secondary">Google Not Connected</div>
        <div class="mt-2 text-sm text-secondary mb-6">Connect your Google account to browse your photos.</div>
        <button mat-flat-button color="primary" (click)="connectGoogle()">
            <mat-icon>login</mat-icon>
            Connect Google
        </button>
    </div>

    <!-- Connected state -->
    <ng-container *ngIf="isGoogleConnected">

        <!-- Header -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between p-6 sm:py-8 md:px-8 border-b bg-card">
            <div>
                <div class="text-3xl font-bold tracking-tight leading-none">Google Photos</div>
                <div class="mt-1 font-medium text-secondary">
                    {{pickedItems.length > 0 ? pickedItems.length + ' photo' + (pickedItems.length !== 1 ? 's' : '') + ' selected' : 'Select photos to migrate'}}
                </div>
            </div>
            <div class="flex items-center gap-3 mt-4 sm:mt-0">
                <button mat-flat-button color="primary" (click)="selectPhotos()" [disabled]="loading || polling">
                    <mat-icon>photo_library</mat-icon>
                    {{ pickedItems.length > 0 ? 'Select More' : 'Select Photos' }}
                </button>
            </div>
        </div>

        <!-- Polling state -->
        <div *ngIf="polling" class="spinner-wrapper">
            <mat-spinner diameter="44" strokeWidth="4"></mat-spinner>
            <p class="text-sm font-medium" style="color: rgba(0,0,0,0.6);">Waiting for photo selection...</p>
            <p class="text-xs text-secondary">Select photos in the Google Photos picker window</p>
        </div>

        <!-- Loading -->
        <div *ngIf="loading && !polling" class="spinner-wrapper">
            <mat-spinner diameter="44" strokeWidth="4"></mat-spinner>
            <p class="text-sm font-medium" style="color: rgba(0,0,0,0.6);">Loading photos...</p>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="mx-6 md:mx-8 mt-4 p-4 rounded-xl flex items-center gap-3"
             style="background: #fef2f2; border: 1px solid #fecaca;">
            <mat-icon style="color: #dc2626; font-size: 20px; width: 20px; height: 20px;">error_outline</mat-icon>
            <span class="flex-1 text-sm" style="color: #991b1b;">{{error}}</span>
            <button mat-icon-button (click)="selectPhotos()" matTooltip="Retry">
                <mat-icon>refresh</mat-icon>
            </button>
        </div>

        <!-- Empty state -->
        <div *ngIf="!loading && !polling && pickedItems.length === 0 && !error"
             class="flex flex-auto flex-col items-center justify-center">
            <mat-icon style="font-size: 80px; width: 80px; height: 80px; color: rgba(0,0,0,0.15);">collections</mat-icon>
            <div class="mt-4 text-xl font-semibold tracking-tight text-secondary">No photos selected</div>
            <div class="mt-2 text-sm text-secondary">Click the button above to pick photos from Google.</div>
        </div>

        <!-- Photos grid -->
        <div *ngIf="!loading && !polling && pickedItems.length > 0"
            class="p-6 md:p-8 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3">
            <div *ngFor="let item of pickedItems"
                class="photo-card cursor-pointer"
                (click)="viewPhoto(item)"
                [matTooltip]="item.mediaFile.filename">
                <img [secureImage]="getThumbUrl(item)" [alt]="item.mediaFile.filename">
            </div>
        </div>

    </ng-container>
</div>
